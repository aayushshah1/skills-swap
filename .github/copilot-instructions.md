# Project: Skill Swap

# Context: Users can create "Swap" request when they want to exchange skills with each other.

## Working:

1. User Signs up on the website, and creates a profile (public/private), with available days, and location
2. User creates a swap request with Skill Offered, Skill Requested and description

### Match Matrix:

Requester is Public, Receivers are Public: Requester sees list of all public profiles that are an exact match, sort them by rating, and send requests to individual people. Those people receive messages.
Requester is Public, Receivers are Private: Requester only sees public profiles. Receivers can see the public requester, show that they are interested (This will reveal their identity to the requester)
Requester is Private, Receivers are Public: Same experience as for Requester as in Public. Receivers get anonymous profiles, with rating and available days. They can show interest (a message gets sent)
Requester is Private, Receivers are Private: Requester only sees public profiles. Receivers get anonymous , with rating and available days. They can show interest (a message gets sent)

### Things implemented:

Backend: Supabase

1. RBAC implemented

2. Tables

-   User Table

```sql
create table public.user (
  created_at timestamp with time zone not null default now(),
  first_name character varying null,
  last_name character varying null,
  uid uuid not null default auth.uid (),
  display_name text null,
  public boolean null default true,
  roles public.app_role null default 'user'::app_role,
  location character varying(100) null,
  availability weekday[] null default '{}'::weekday[],
  photo_url text null,
  constraint user_pkey primary key (uid),
  constraint user_uid_key unique (uid),
  constraint user_uid_fkey foreign KEY (uid) references auth.users (id)
) TABLESPACE pg_default;

create index IF not exists idx_user_location on public."user" using btree (location) TABLESPACE pg_default;

create index IF not exists idx_user_public on public."user" using btree (public) TABLESPACE pg_default;
```

-   Swap Table

```sql
create table public.swap_requests (
  id bigint generated by default as identity not null,
  requester_uid uuid not null,
  skill_offered character varying(100) not null,
  skill_requested character varying(100) not null,
  description text null,
  status character varying(20) not null default 'pending'::character varying,
  created_at timestamp with time zone not null default now(),
  updated_at timestamp with time zone not null default now(),
  constraint swap_requests_pkey primary key (id),
  constraint swap_requests_requester_uid_fkey foreign KEY (requester_uid) references "user" (uid) on delete CASCADE,
  constraint swap_requests_skill_offered_fkey foreign KEY (skill_offered) references skills (name) on update CASCADE,
  constraint swap_requests_skill_requested_fkey foreign KEY (skill_requested) references skills (name) on update CASCADE,
  constraint swap_requests_status_check check (
    (
      (status)::text = any (
        (
          array[
            'pending'::character varying,
            'accepted'::character varying,
            'rejected'::character varying,
            'cancelled'::character varying,
            'completed'::character varying
          ]
        )::text[]
      )
    )
  )
) TABLESPACE pg_default;

create index IF not exists idx_swap_requests_requester_uid on public.swap_requests using btree (requester_uid) TABLESPACE pg_default;

create index IF not exists idx_swap_requests_skill_offered on public.swap_requests using btree (skill_offered) TABLESPACE pg_default;

create index IF not exists idx_swap_requests_skill_requested on public.swap_requests using btree (skill_requested) TABLESPACE pg_default;

create index IF not exists idx_swap_requests_status on public.swap_requests using btree (status) TABLESPACE pg_default;

create index IF not exists idx_swap_requests_requester_status on public.swap_requests using btree (requester_uid, status) TABLESPACE pg_default;

create trigger update_swap_requests_updated_at BEFORE
update on swap_requests for EACH row
execute FUNCTION update_updated_at_column ();
```

-   Skills

```sql
create table public.skills (
  id bigint generated by default as identity not null,
  name character varying(100) not null,
  category character varying(50) not null,
  created_at timestamp with time zone not null default now(),
  constraint skills_pkey primary key (id),
  constraint skills_name_key unique (name)
) TABLESPACE pg_default;
```

-   Role Permissions

```sql
create table public.role_permissions (
  id bigint generated by default as identity not null,
  role public.app_role not null,
  permission public.app_permission not null,
  constraint role_permissions_pkey primary key (id),
  constraint role_permissions_role_permission_key unique (role, permission)
) TABLESPACE pg_default;
```

### Things to implement
1) Matching Matrix
2) Messages Table
3) Request Resolution